processes:
  - name: perm
    executable: /var/vcap/jobs/perm/bin/perm

    args:
    - serve
    - --listen-hostname
    - <%= p('listen_hostname') %>
    - --listen-port
    - <%= p('listen_port') %>
    - --log-level
    - <%= p('log_level') %>
    - --tls-certificate
    - /var/vcap/jobs/perm/config/certs/tls.crt
    - --tls-key
    - /var/vcap/jobs/perm/config/certs/tls.key
    - --sql-db-driver
    - <%= p('sql.db.driver') %>
    - --sql-db-host
    - <%= p('sql.db.host') %>
    - --sql-db-port
    - <%= p('sql.db.port') %>
    - --sql-db-schema
    - <%= p('sql.db.schema') %>
    - --sql-db-username
    - <%= p('sql.db.username') %>
    - --sql-db-password
    - <%= p('sql.db.password') %>
    - --sql-tls-required
    - <%= p('sql.tls.required') %>
    - --sql-tls-root-ca
    - /var/vcap/jobs/perm/config/certs/sql_tls_ca.crt
    - --sql-connection-max-lifetime
    - <%= p('sql.tuning.connection_max_lifetime') %>

    limits:
      memory: 256M
      processes: 100
      open_files: 524
